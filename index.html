<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Practice Quiz</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 12px; }
    #options button { display:block; width:100%; text-align:left; margin:10px 0; padding:12px; }
    #meta { opacity: .8; margin-bottom: 6px; }
    #qid { font-size: 0.9rem; color: #555; margin-bottom: 6px; }
  </style>
</head>
<body>

  <div id="meta"></div>
  <div id="qid"></div>
  <h2 id="q">Načítám…</h2>
  <div id="options"></div>
  <button id="nextBtn" disabled>Další</button>

<script>
  const QUESTION_COUNT = 20;

  let quiz = [];
  let index = 0;
  let score = 0;
  let locked = false;

  function shuffle(arr) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function normalizeQuestion(q) {
    const letters = Object.keys(q.moznosti);
    return {
      id: q.id,
      text: q.otazka,
      options: letters.map(l => ({ letter: l, text: q.moznosti[l] })),
      correctLetter: q.oznacena_odpoved
    };
  }

  function showQuestion() {
    locked = false;
    document.getElementById("nextBtn").disabled = true;

    const q = quiz[index];

    document.getElementById("meta").textContent =
      `Otázka ${index + 1} / ${quiz.length}`;

    document.getElementById("qid").textContent =
      `ID otázky: ${q.id}`;

    document.getElementById("q").textContent = q.text;

    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";

    q.options.forEach(opt => {
      const btn = document.createElement("button");
      btn.textContent = `${opt.letter.toUpperCase()}) ${opt.text}`;
      btn.onclick = () => choose(opt.letter);
      optionsDiv.appendChild(btn);
    });
  }

  function choose(letter) {
    if (locked) return;
    locked = true;

    const q = quiz[index];
    if (letter === q.correctLetter) score++;

    const buttons = [...document.querySelectorAll("#options button")];
    buttons.forEach(b => {
      const btnLetter = b.textContent[0].toLowerCase();
      if (btnLetter === q.correctLetter) b.style.border = "2px solid #2e7d32";
      if (btnLetter === letter && letter !== q.correctLetter) b.style.border = "2px solid #c62828";
      b.disabled = true;
    });

    document.getElementById("nextBtn").disabled = false;
  }

  function next() {
    index++;
    if (index < quiz.length) {
      showQuestion();
    } else {
      document.body.innerHTML = `
        <h1>Skóre: ${score} / ${quiz.length}</h1>
        <button onclick="location.reload()">Zkusit znovu</button>
      `;
    }
  }

  document.getElementById("nextBtn").addEventListener("click", next);

  async function init() {
    try {
      const res = await fetch("quiz.json?v=" + Date.now());
      if (!res.ok) throw new Error(`Nejde načíst quiz.json (HTTP ${res.status})`);

      const data = await res.json();
      const raw = data.test_autoškola;

      if (!Array.isArray(raw) || raw.length === 0) {
        throw new Error("quiz.json: chybí pole test_autoškola.");
      }

      quiz = shuffle(raw.map(normalizeQuestion))
              .slice(0, Math.min(QUESTION_COUNT, raw.length));

      index = 0;
      score = 0;
      showQuestion();
    } catch (err) {
      document.getElementById("q").textContent = "Chyba při načítání otázek";
      document.getElementById("options").innerHTML = `<pre>${String(err)}</pre>`;
      console.error(err);
    }
  }

  init();
</script>

</body>
</html>

